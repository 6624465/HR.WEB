@model HR.Web.ViewModels.UpdateVariablePayVm

@using (Html.BeginForm("SaveVariablePaytransaction", "PayrollBatch", FormMethod.Post, new { id = "variablesave", name = "variablesave" }))
{
    <div class="page">
        <div class="page-wrap">
            <div class="panel-group">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        UPDATE VARIABLE PAY
                    </div>
                    <div class="panel-body">
                        @Html.HiddenFor(x => x.variablepaymentheader.HeaderID)
                        <div class="row css5">

                            <label class="col-md-2 control-label">
                                <span class="pull-right">TransactionNo</span>
                            </label>
                            <div class="col-md-3">
                                @Html.TextBoxFor(x => x.variablepaymentheader.TransactionNo, new { @class = "form-control input-sm uppercase" })
                            </div>

                            <label class="col-md-2 control-label">
                                <span class="pull-right">Month</span>
                            </label>
                            <div class="col-md-1">
                                @Html.DropDownListFor(x => x.variablepaymentheader.Month, SelectListItemHelper.GetMonths(), new { @class = "form-control input-sm" })

                            </div>
                            <label class="col-md-1 control-label">
                                <span class="pull-right">Year</span>
                            </label>
                            <div class="col-md-1 pull-left">
                                @Html.DropDownListFor(x => x.variablepaymentheader.Year, SelectListItemHelper.GetYears(), new { @class = "form-control input-sm" })
                            </div>
                        </div>
                        <div class="row css10">
                            <div class="col-md-12">
                                @if (Model.Employeetable != null && Model.Employeetable.Count() > 0)
                                {
                                    <table class="table table-conden table-bordered">
                                        <thead>
                                            <tr>
                                                <th> Employee Name</th>
                                                <th>Employee Designation</th>
                                                <th>
                                                    Manager Name
                                                </th>
                                                <th>
                                                    #Action
                                                </th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            @for (var i = 0; i < Model.Employeetable.Count; i++)
                                            {

                                                <tr>
                                                    <td>
                                                        @Model.Employeetable[i].EmployeeName
                                                    </td>
                                                    <td>
                                                        @Model.Employeetable[i].EmployeeDesignation
                                                    </td>
                                                    <td>
                                                        @Model.Employeetable[i].ManagerName
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-xs btn-raised waves-effect btn-sm" style="padding-left: 5px;margin-left: 6px;"
                                                                onclick="EditVariablePay(@Model.Employeetable[i].EmployeeId)">
                                                            <i class="fa fa-pencil" style="padding-left: 5px;"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                }
                            </div>

                        </div>


                        <div class="row">
                            <button type="button" class="btn btn-primary btn-sm" onclick="Savetrans()"><i class="fa fa-floppy-o"></i>Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    @*@using (Html.BeginForm("SaveVariablePay", "PayrollBatch", FormMethod.Post, new { id = "Variablepayfrm", name = "Variablepayfrm" }))
        {*@
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Variable Pay Edit</h4>
                    <button class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <div class="modal-body" id="modalContent">
                    @if (Model.variablepaymentdetail != null && Model.variablepaymentdetail.Count > 0)
                    {
                        <div class="row css10">
                            <div class="col-md-12">
                                <table class="table table-conden table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Employee ID</th>
                                            <th>Component</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for (int i = 0; i < Model.variablepaymentdetail.Count; i++)
                                        {
                                            <tr>
                                                <td>
                                                    @Model.variablepaymentdetail[i].EmployeeId
                                                </td>
                                                <td>
                                                    <input id="variablepaymentdetail_@(i)__DetailID"
                                                           name="variablepaymentdetail[@(i)].DetailID"
                                                           type="hidden"
                                                           value="@Model.variablepaymentdetail[i].DetailID">
                                                    <input id="variablepaymentdetail_@(i)EmployeeId"
                                                           name="variablepaymentdetail[@(i)].EmployeeId"
                                                           type="hidden"
                                                           value="@Model.variablepaymentdetail[i].EmployeeId">
                                                    <input id="variablepaymentdetail_@(i)HeaderId"
                                                           name="variablepaymentdetail[@(i)].HeaderId"
                                                           type="hidden"
                                                           value="@Model.variablepaymentdetail[i].HeaderId">
                                                    <input id="variablepaymentdetail_@(i)ComponentCode"
                                                           name="variablepaymentdetail[@(i)].ComponentCode"
                                                           type="hidden"
                                                           value="@Model.variablepaymentdetail[i].ComponentCode">
                                                    @Model.variablepaymentdetail[i].ComponentCode
                                                </td>
                                                <td>
                                                    <input type="hidden"
                                                           value="@Model.variablepaymentdetail[i].Amount"
                                                           id="variablepaymentdetail_@(i)Amount"
                                                           name="variablepaymentdetail[@(i)].Amount" />
                                                    @Model.variablepaymentdetail[i].Amount
                                                </td>
                                            </tr>
                                        }
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    }

                </div>
                <div class="modal-footer">
                    <button id="btnsave" type="button" class="btn btn-primary btn-sm" onclick="SaveChanges()"><i class="fa fa-floppy-o"></i>Save</button>
                </div>
            </div>

        </div>
    </div>
    @*}*@
}

@section Scripts{
    <script type="text/javascript">
            function getFormData($form) {
                var unindexed_array = $form.serializeArray();
                var indexed_array = {};

                $.map(unindexed_array, function (n, i) {
                    indexed_array[n['name']] = n['value'];
                });

                return indexed_array;
            }

            function EditVariablePay(Employeeid) {

                var $form = $("#variablesave");
                var data = getFormData($form);

                //var jsondata = " ";
                //jsondata = $("#variablesave").serialize();
                //var object = JSON.parse(data);
                //$('#Description').val('');
                //$('#Date').val('');
                //$('#CountryId').val('');
                //$('#myModal').modal('show');
                $.ajax({
                    url: '@Url.Content("~/PayrollBatch/EditVariablePay?Employeeid=")' + Employeeid,
                    contentType: 'application/json; charset=utf-8',
                    method: 'Post',
                    data: JSON.stringify(data),
                    //dataType: 'json',
                    success: function (data) {
                    $('#myModal').modal('show');
                    //$('#modalContent').html('');
                    $('#modalContent').html(data);
            }
        });
    }
    function SaveChanges() {
        if (true) {//$('#variablesave').valid()
            $('#variablesave').attr('action', '@Url.Content("~/PayrollBatch/SaveVariablePay")');
            $('#variablesave').submit();
        }
    }

            function Savetrans() {
                $('#variablesave').submit();
            @*if ($('#variablesave').valid()) {
                $('#variablesave').attr('action', '@Url.Content("~/PayrollBatch/SaveVariablePaytransaction")');
                $('#variablesave').submit();
                swal({
                    title: "Saved Successfully",
                    text: "",
                    closeOnConfirm: true,
                    confirmButtonText: "Ok",
                    confirmButtonClass: "btn-primary",
                    timer: 5000
                },
                    function () {
                        $.loader({
                            className: "blue-with-image-2",
                            content: '',
                        });
                    })
            }*@
        }
    </script>

}


